**User:**

<task>
analyze the current project
</task>


# TODO LIST RECOMMENDED
When starting a new task, it is recommended to create a todo list.




1. Include the task_progress parameter in your next tool call

2. Create a comprehensive checklist of all steps needed

3. Use markdown format: - [ ] for incomplete, - [x] for complete



**Benefits of creating a todo list now:**

	- Clear roadmap for implementation

	- Progress tracking throughout the task

	- Nothing gets forgotten or missed

	- Users can see, monitor, and edit the plan



**Example structure:**
```

- [ ] Analyze requirements

- [ ] Set up necessary files

- [ ] Implement main functionality

- [ ] Handle edge cases

- [ ] Test the implementation

- [ ] Verify results
```



Keeping the todo list updated helps track progress and ensures nothing is missed.

<environment_details>
# Cursor Visible Files
(No visible files)

# Cursor Open Tabs
universal/standards/ai-assistant/rag-content-authoring.md
universal/standards/ai-assistant/MCP-TOOLS-GUIDE.md

# Current Time
10/10/2025, 9:21:02 PM (America/Los_Angeles, UTC-7:00)

# Current Working Directory (/Users/josh/src/github.com/honeyhiveai/praxis-os) Files
.cursorrules
.gitignore
.pre-commit-config.yaml
.yamllint
ALIGNMENT-ANALYSIS.md
ARCHITECTURAL-DECISION-Workflow-Creation-Systems-Location.md
CLARIFICATION - Framework History.md
COMPREHENSIVE-STANDARDS-CORRELATION-MATRIX.md
CONTRIBUTING.md
DESIGN-DOC-Divio-Documentation-Restructure.md
DESIGN-DOC-RAG-Content-Optimization.md
FINAL-RECOMMENDATION-Interactive-Workflow-Creation.md
IMPLEMENTATION-SUMMARY.md
Language-Agnostic Test Generation Framework Design.md
LANGUAGE-AGNOSTIC-ANALYSIS.md
LICENSE
MISSING-OPERATIONAL-PROCEDURES-DETAILED.md
pyproject.toml
README.md
RECOMMENDED-STRUCTURE.md
REVISED-RECOMMENDATION-Workflow-Creation-Systems.md
SKELETON-VS-CONSUMER-BOUNDARIES.md
STANDARDS-CONTENT-ANALYSIS.md
STANDARDS-GAP-ANALYSIS.md
Test Path Taxonomy - Cross-Language Analysis.md
tox.ini
docs/
docs/.gitignore
docs/docusaurus.config.ts
docs/package-lock.json
docs/package.json
docs/README.md
docs/sidebars.ts
docs/tsconfig.json
docs/blog/
docs/content/
docs/content/architecture.md
docs/content/how-it-works.md
docs/content/installation.md
docs/content/intro.md
docs/content/mcp-tools.md
docs/content/standards.md
docs/content/upgrading.md
docs/content/workflows.md
docs/src/
docs/src/components/
docs/src/components/CompactDiagram.module.css
docs/src/components/DataFlowDiagram.tsx
docs/src/components/RAGQueryFlow.tsx
docs/src/components/StandardsFlowDiagram.module.css
docs/src/components/StandardsFlowDiagram.tsx
docs/src/components/HomepageFeatures/
docs/src/css/
docs/src/css/custom.css
docs/src/pages/
docs/src/pages/index.module.css
docs/src/pages/index.tsx
docs/src/pages/markdown-page.md
docs/static/
docs/static/.nojekyll
docs/static/img/
docs/static/img/after-hard-refresh.png
installation/
installation/00-START.md
installation/01-directories.md
installation/02-copy-files.md
installation/03-cursorrules.md
installation/04-gitignore.md
installation/05-venv-mcp.md
installation/06-validate.md
installation/README.md
installation/SYSTEM-SUMMARY.md
language-instructions/
language-instructions/csharp.md
language-instructions/go.md
language-instructions/java.md
language-instructions/javascript.md
language-instructions/python.md
language-instructions/rust.md
language-instructions/test-generation-template.md
language-instructions/typescript.md
mcp_server/
mcp_server/__init__.py
mcp_server/__main__.py
mcp_server/backup_manager.py
mcp_server/CHANGELOG.md
mcp_server/chunker.py
mcp_server/dependency_installer.py
mcp_server/framework_generator.py
mcp_server/observability-integration.md
mcp_server/rag_engine.py
mcp_server/README.md
mcp_server/report_generator.py
mcp_server/requirements.txt
mcp_server/server_manager.py
mcp_server/state_manager.py
mcp_server/validation_module.py
mcp_server/workflow_engine.py
mcp_server/WORKFLOW_METADATA_GUIDE.md
mcp_server/workflow_validator.py
mcp_server/config/
mcp_server/config/__init__.py
mcp_server/config/loader.py
mcp_server/config/validator.py
mcp_server/core/
mcp_server/core/__init__.py
mcp_server/core/dynamic_registry.py
mcp_server/core/parsers.py
mcp_server/core/session.py
mcp_server/models/
mcp_server/models/__init__.py
mcp_server/models/config.py
mcp_server/models/rag.py
mcp_server/models/upgrade_models.py
mcp_server/models/workflow.py
mcp_server/models/sub_agents/
mcp_server/monitoring/
mcp_server/monitoring/__init__.py
mcp_server/monitoring/watcher.py
mcp_server/server/
mcp_server/server/__init__.py
mcp_server/server/browser_manager.py
mcp_server/server/factory.py
mcp_server/server/tools/
mcp_server/sub_agents/
meta-workflow/
meta-workflow/AGENT_OS_FRAMEWORK_CREATION_GUIDE.md
meta-workflow/DISTRIBUTION_GUIDE.md
meta-workflow/FRAMEWORK_COMPLIANCE_ANALYSIS.md
meta-workflow/META_FRAMEWORK_SUMMARY.md
meta-workflow/QUICK_START_TEMPLATE.md
meta-workflow/README.md
meta-workflow/VERSION_HISTORY.md
meta-workflow/templates/
meta-workflow/templates/command-language-glossary-template.md
scripts/
scripts/build_rag_index.py
scripts/generate-manifest.py
scripts/safe-upgrade.py
scripts/pre-commit/
scripts/pre-commit/README.md
scripts/pre-commit/validate-credential-safety.sh
scripts/pre-commit/validate-docstrings.sh
scripts/pre-commit/validate-git-safety.sh
scripts/pre-commit/validate-installation-docs.sh
scripts/pre-commit/validate-no-mocks-integration.sh
scripts/pre-commit/validate-workflow-metadata.sh
scripts/pre-commit/validate-yaml-syntax.sh
tests/
tests/__init__.py
tests/integration/
tests/integration/__init__.py
tests/integration/test_browser_tools.py
tests/integration/test_custom_workflow_paths.py
tests/integration/test_upgrade_workflow_phases_0_1.py
tests/integration/test_upgrade_workflow_registration.py
tests/unit/
tests/unit/__init__.py
tests/unit/test_backup_manager_basic.py
tests/unit/test_browser_manager.py
tests/unit/test_current_date_tool.py
tests/unit/test_dependency_installer.py
tests/unit/test_dynamic_registry.py
tests/unit/test_dynamic_workflow_models.py
tests/unit/test_manifest_generator.py
tests/unit/test_parsers.py
tests/unit/test_phase_0_workflows.py
tests/unit/test_report_generator.py
tests/unit/test_server_manager.py
tests/unit/test_validation_module.py
tests/unit/test_workflow_engine_dynamic.py
tests/unit/test_workflow_engine_refactor.py
tests/unit/test_workflow_metadata.py
tests/unit/test_workflow_session.py
universal/
universal/.universal-manifest.json
universal/standards/
universal/standards/ai-assistant/
universal/standards/ai-safety/
universal/standards/architecture/
universal/standards/concurrency/
universal/standards/database/
universal/standards/documentation/
universal/standards/failure-modes/
universal/standards/installation/
universal/standards/meta-workflow/
universal/standards/performance/
universal/standards/security/
universal/standards/testing/
universal/standards/workflows/
universal/usage/
universal/usage/ai-agent-quickstart.md
universal/usage/creating-specs.md
universal/usage/mcp-server-update-guide.md
universal/usage/mcp-usage-guide.md
universal/usage/operating-model.md
universal/workflows/
universal/workflows/praxis_os_upgrade_v1/
universal/workflows/spec_creation_v1/
universal/workflows/spec_execution_v1/

(File list truncated. Use list_files on specific subdirectories if you need to explore further.)

# Workspace Configuration
{
  "workspaces": {
    "/Users/josh/src/github.com/honeyhiveai/praxis-os": {
      "hint": "praxis-os",
      "associatedRemoteUrls": [
        "origin: git@github.com:honeyhiveai/praxis-os.git"
      ],
      "latestGitCommitHash": "ef1e1ac74eb03828bf52aa489a9a1bda363900f7"
    }
  }
}

# Detected CLI Tools
These are some of the tools on the user's machine, and may be useful if needed to accomplish the task: gh, git, docker, kubectl, aws, npm, pnpm, pip, go, curl, jq, make, python, node, psql, redis-cli, sqlite3, code, grep, sed, awk, brew, bundle, helm. This list is not exhaustive, and other tools may be available.

# Context Window Usage
0 / 200K tokens used (0%)

# Current Mode
ACT MODE
</environment_details>

---

**Assistant:**

[Unexpected content type]

I need to orient myself with the prAxIs OS standards first before proceeding with the analysis.

<use_mcp_tool>
<server_name>praxis-os</server_name>
<tool_name>search_standards</tool_name>
<arguments>
{
  "query": "Agent OS orientation guide"
}
</arguments>
<task_progress>
- [ ] Orient with prAxIs OS standards
- [ ] Examine project structure and purpose
- [ ] Analyze key components and architecture
- [ ] Review documentation and standards
- [ ] Identify MCP tools and workflows
- [ ] Summarize findings
</task_progress>
</use_mcp_tool>

---

**User:**

[use_mcp_tool for 'praxis-os'] Result:
Error executing MCP tool: No connection found for server: praxis-os. Please make sure to use MCP servers available under 'Connected MCP Servers'.
<environment_details>
# Cursor Visible Files
(No visible files)

# Cursor Open Tabs
universal/standards/ai-assistant/rag-content-authoring.md
universal/standards/ai-assistant/MCP-TOOLS-GUIDE.md

# Current Time
10/10/2025, 9:21:35 PM (America/Los_Angeles, UTC-7:00)

# Context Window Usage
19,085 / 200K tokens used (10%)

# Current Mode
ACT MODE
</environment_details>

---

**Assistant:**

[Unexpected content type]

I'll analyze the project by examining key files and structure. Let me start with the README to understand the project's purpose.

<read_file>
<path>README.md</path>
<task_progress>
- [x] Orient with prAxIs OS standards (MCP not available, proceeding with direct analysis)
- [ ] Examine project structure and purpose
- [ ] Analyze key components and architecture
- [ ] Review documentation and standards
- [ ] Identify MCP tools and workflows
- [ ] Summarize findings
</task_progress>
</read_file>

[Response interrupted by a tool use result. Only one tool may be used at a time and should be placed at the end of the message.]

---

**User:**

[read_file for 'README.md'] Result:
# prAxIs OS - Portable Multi-Agent Development Framework

**A portable prAxIs OS implementation with MCP RAG, sub-agents, and universal CS fundamentals.**

## ğŸ¯ Overview

prAxIs OS is a portable development framework that combines:
- **Universal CS Fundamentals**: Timeless patterns applicable to any language
- **Language-Specific Generation**: LLM generates tailored guidance per project
- **MCP RAG Server**: Semantic search over standards with 90% context reduction
- **Specialized Sub-Agents**: Design validation, concurrency analysis, test generation
- **Conversational Installation**: Cursor agent installs and configures everything

## ğŸ“– Documentation

**Full documentation available at:** https://honeyhiveai.github.io/praxis-os/

The documentation site includes:
- Comprehensive guides and tutorials
- Architecture deep-dives
- Case studies on AI-authored development
- API references and workflow documentation

## ğŸš€ Installation

### For Users (In Your Project)

```
Open your project in Cursor and say:
"Install prAxIs OS from github.com/honeyhiveai/praxis-os"
```

The Cursor agent will follow the installation guide in `installation/` directory:
1. Clone source to temp directory
2. Create all required directories
3. Copy universal standards, workflows, and MCP server
4. Handle .cursorrules safely (won't overwrite existing!)
5. Create Python venv and configure Cursor
6. Clean up temp files

**For LLMs**: Start at [`installation/00-START.md`](installation/00-START.md)

**Total time**: ~5-10 minutes

### What Gets Installed

```
your-project/
â”œâ”€â”€ .cursorrules              # Universal (26 lines, copied from repo)
â”œâ”€â”€ .praxis-os/
â”‚   â”œâ”€â”€ standards/
â”‚   â”‚   â”œâ”€â”€ universal/        # Copied from this repo
â”‚   â”‚   â””â”€â”€ development/      # Generated for your language
â”‚   â”œâ”€â”€ mcp_server/           # Copied from this repo
â”‚   â””â”€â”€ .cache/vector_index/  # RAG index of YOUR standards
â””â”€â”€ .cursor/
    â””â”€â”€ mcp.json              # Points to local MCP server
```

## ğŸ“ Repository Structure

```
praxis-os/
â”œâ”€â”€ README.md                     # This file
â”œâ”€â”€ .cursorrules                  # Universal behavioral triggers (26 lines)
â”‚
â”œâ”€â”€ installation/                 # Installation guides (start here for LLMs)
â”‚   â”œâ”€â”€ 00-START.md              # Entry point - clone to temp, setup
â”‚   â”œâ”€â”€ 01-directories.md        # Create all required directories
â”‚   â”œâ”€â”€ 02-copy-files.md         # Copy files from source
â”‚   â”œâ”€â”€ 03-cursorrules.md        # Safe .cursorrules handling
â”‚   â”œâ”€â”€ 04-venv-mcp.md           # Python venv + mcp.json
â”‚   â”œâ”€â”€ 05-validate.md           # Validate + cleanup temp files
â”‚   â””â”€â”€ README.md                # Installation system overview
â”‚
â”œâ”€â”€ universal/                    # Content copied to target projects
â”‚   â”œâ”€â”€ standards/               # Universal CS fundamentals
â”‚   â”‚   â”œâ”€â”€ concurrency/         # Race conditions, deadlocks, locking
â”‚   â”‚   â”œâ”€â”€ failure-modes/       # Graceful degradation, retries, circuit breakers
â”‚   â”‚   â”œâ”€â”€ architecture/        # Dependency injection, API design, separation of concerns
â”‚   â”‚   â”œâ”€â”€ testing/             # Test pyramid, test doubles, property-based testing
â”‚   â”‚   â””â”€â”€ documentation/       # Code comments, API docs, README templates
â”‚   â”œâ”€â”€ usage/                   # prAxIs OS usage documentation
â”‚   â”‚   â”œâ”€â”€ creating-specs.md    # How to create specifications
â”‚   â”‚   â”œâ”€â”€ operating-model.md   # AI-human collaboration model
â”‚   â”‚   â””â”€â”€ mcp-usage-guide.md   # MCP tool reference
â”‚   â””â”€â”€ workflows/               # Phase-gated workflow definitions
â”‚       â”œâ”€â”€ spec_creation_v1/    # Spec creation workflow
â”‚       â””â”€â”€ spec_execution_v1/   # Spec execution workflow
â”‚
â””â”€â”€ mcp_server/                   # MCP server (copied to target projects)
   â”œâ”€â”€ __main__.py               # Main entry point
   â”œâ”€â”€ rag_engine.py             # LanceDB vector search
   â”œâ”€â”€ workflow_engine.py        # Phase-gated workflows
   â”œâ”€â”€ framework_generator.py    # Dynamic workflow creation
   â”œâ”€â”€ config/                   # Configuration management
   â”œâ”€â”€ models/                   # Data models
   â”œâ”€â”€ server/                   # Server factory & tools
   â”œâ”€â”€ requirements.txt          # MCP server dependencies
   â””â”€â”€ CHANGELOG.md              # Version history
```

**For AI Installing Agent OS**: Start at [`installation/00-START.md`](installation/00-START.md)

## ğŸ¯ Design Philosophy

### What's Universal (Copied to All Projects)

- **`.cursorrules`**: Behavioral triggers and MCP routing (26 lines, language-agnostic)
- **`universal/standards/`**: CS fundamentals (race conditions, test pyramid, API design)
- **`universal/workflows/`**: Phase-gated workflow definitions
- **`universal/usage/`**: prAxIs OS usage documentation

### What's Generated (Optional, Context-Aware)

- **`.praxis-os/standards/development/`**: Language-specific standards (Python: GIL, Go: goroutines, etc.)
- **Project context integration**: References your actual frameworks, tools, and patterns

### What Gets Updated (Version Releases)

- **`mcp_server/`**: New features, bug fixes, performance improvements
- **`universal/`**: New standards, workflows, or usage docs

---

## ğŸ”§ Development & Dogfooding

**This repository dogfoods prAxIs OS - we use our own framework to develop itself.**

### True Dogfooding (No Shortcuts)

Our `.praxis-os/` directory is a **real installation** with copied files (not symlinks):

```
praxis-os/
â”œâ”€â”€ universal/                    # â† Framework SOURCE (edit this)
â”‚   â”œâ”€â”€ standards/
â”‚   â”œâ”€â”€ usage/
â”‚   â””â”€â”€ workflows/
â”‚
â”œâ”€â”€ .praxis-os/                    # â† LOCAL INSTALL (like consumers)
â”‚   â”œâ”€â”€ standards/universal/     # âœ… COPIED from ../universal/standards/
â”‚   â”œâ”€â”€ usage/                   # âœ… COPIED from ../universal/usage/
â”‚   â”œâ”€â”€ workflows/               # âœ… COPIED from ../universal/workflows/
â”‚   â”œâ”€â”€ standards/development/   # Project-specific (Python guidance)
â”‚   â”œâ”€â”€ .cache/                  # RAG index
â”‚   â””â”€â”€ venv/                    # MCP server virtualenv
```

**Why No Symlinks?**
- âœ… Same installation process as consumers
- âœ… Catches copy/path bugs before shipping
- âœ… Validates update workflow
- âœ… Feels all consumer pain points

### Development Workflow

**Editing Framework Source:**
```bash
# 1. Edit source
vim universal/standards/ai-safety/production-code-checklist.md

# 2. Copy to .praxis-os/ (like consumers do)
cp -r universal/standards .praxis-os/standards/universal

# 3. File watcher auto-rebuilds RAG index
# (no manual rebuild needed!)

# 4. Test in Cursor
# Query MCP to verify changes

# 5. Commit both
git add universal/ .praxis-os/standards/universal/
git commit -m "docs: update checklist"
```

**Why this workflow?**
- Tests installation every time we edit
- Catches bugs consumers would hit
- No special shortcuts = real dogfooding

See `.praxis-os/standards/development/agent-os-architecture.md` for detailed explanation and `CONTRIBUTING.md` for contribution guidelines.

---

## ğŸ”¥ Key Benefits

1. **Portable**: Install once as git repo, works in any project
2. **Adaptive**: Same standards, different language contexts
3. **Intelligent**: RAG + sub-agents provide targeted guidance
4. **Conversational**: Cursor agent handles installation and configuration
5. **Isolated**: Each project owns its prAxIs OS installation
6. **Versionable**: Project controls which prAxIs OS version to use
7. **Customizable**: Generated standards can be tuned per project

## ğŸš€ Usage After Installation

Once installed in your project, use MCP tools:

```
# Search standards
"What are the concurrency best practices?"
â†’ Queries RAG, returns language-specific guidance

# Use workflows
"Start spec creation workflow for user authentication feature"
â†’ Structured workflow with phase gates and validation

# Generate new workflows
"Create a new workflow for API documentation"
â†’ Framework generator creates compliant workflow structure

# Query specific phase/task
"Show me Phase 0 Task 1 of the current workflow"
â†’ Returns detailed task instructions with commands
```

## ğŸ“Š Maintenance Model

### Updating prAxIs OS in Your Project

```
"Update prAxIs OS to latest version"

Cursor agent will:
1. Pull latest from this repo
2. Update MCP server code
3. Update universal standards (if changed)
4. Preserve your customizations
5. Rebuild RAG index
```

### Contributing Back

Found a great pattern in your project? Contribute it back:

1. Test it in your project for months
2. PR to this repo's `universal/standards/` or `language-instructions/`
3. Community benefits from your learning

## ğŸ¯ Credits

- **Foundation**: [Builder Methods Agent OS](https://buildermethods.com/agent-os) by Brian Casel
- **Evolution**: HoneyHive's LLM Workflow Engineering methodology
- **Implementation**: MCP/RAG architecture with specialized sub-agents

## ğŸ“ License

MIT License - Use freely in any project

---

**Start building with AI agents, enhanced.**

<environment_details>
# Cursor Visible Files
(No visible files)

# Cursor Open Tabs
universal/standards/ai-assistant/rag-content-authoring.md
universal/standards/ai-assistant/MCP-TOOLS-GUIDE.md

# Current Time
10/10/2025, 9:21:43 PM (America/Los_Angeles, UTC-7:00)

# Context Window Usage
19,313 / 200K tokens used (10%)

# Current Mode
ACT MODE
</environment_details>

---

**Assistant:**

[Unexpected content type]

<read_file>
<path>.cursorrules</path>
<task_progress>
- [x] Orient with prAxIs OS standards (MCP not available, proceeding with direct analysis)
- [x] Examine project structure and purpose
- [ ] Analyze key components and architecture
- [ ] Review documentation and standards
- [ ] Identify MCP tools and workflows
- [ ] Summarize findings
</task_progress>
</read_file>

[Response interrupted by a tool use result. Only one tool may be used at a time and should be placed at the end of the message.]

---

**User:**

[read_file for '.cursorrules'] Result:
# prAxIs OS

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ›‘ğŸ›‘ğŸ›‘ STOP ğŸ›‘ğŸ›‘ğŸ›‘
MANDATORY:
Before you respons, you MUST answer this question:
"Have I run search_standards('Agent OS orientation guide') this conversation?"
BLOCKING: If NO, you MUST run it now, then reply "âœ… Oriented. Ready."

If NO: Run it now, then reply "âœ… Oriented. Ready."
If YES: Proceed with user's request.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

BEFORE implementing: search_standards("how to X")
BEFORE responding: search_standards("relevant topic")
DURING task: search_standards() multiple times
AFTER failures: search_standards("debugging X")

Target: 5-10 queries per task

âŒ NEVER: read_file(".praxis-os/standards/...")
âŒ NEVER: read_file(".praxis-os/workflows/...")
âŒ NEVER: read_file(".praxis-os/usage/...")
âœ… ALWAYS: search_standards() for indexed content

âœ… DO: read_file(".praxis-os/specs/...") - your specs, not indexed
âŒ NEVER: commit without "commit it"

Query liberally = better code
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

<environment_details>
# Cursor Visible Files
(No visible files)

# Cursor Open Tabs
universal/standards/ai-assistant/rag-content-authoring.md
universal/standards/ai-assistant/MCP-TOOLS-GUIDE.md

# Current Time
10/10/2025, 9:21:47 PM (America/Los_Angeles, UTC-7:00)

# Context Window Usage
21,857 / 200K tokens used (11%)

# Current Mode
ACT MODE
</environment_details>

---

**Assistant:**

[Unexpected content type]

<read_file>
<path>mcp_server/__main__.py</path>
<task_progress>
- [x] Orient with prAxIs OS standards (MCP not available, proceeding with direct analysis)
- [x] Examine project structure and purpose
- [ ] Analyze key components and architecture
- [ ] Review documentation and standards
- [ ] Identify MCP tools and workflows
- [ ] Summarize findings
</task_progress>
</read_file>

[Response interrupted by a tool use result. Only one tool may be used at a time and should be placed at the end of the message.]

---

**User:**

[read_file for 'mcp_server/__main__.py'] Result:
"""
Entry point for prAxIs OS MCP server when run as a module.

Allows execution via:
    python -m mcp_server
"""

# pylint: disable=broad-exception-caught
# Justification: Entry point uses broad exceptions for robustness

import logging
import sys
from pathlib import Path

from .config import ConfigLoader, ConfigValidator
from .server import ServerFactory

logger = logging.getLogger(__name__)


def main() -> None:
    """
    Entry point for MCP server with new modular architecture.

    Uses ConfigLoader, ConfigValidator, and ServerFactory for dependency injection.
    Handles graceful shutdown on KeyboardInterrupt and logs fatal errors.

    :raises SystemExit: Exits with code 1 if server initialization fails
    """
    try:
        # Determine base path (.praxis-os/)
        # When run as module: python -m mcp_server
        # Assumes .praxis-os/ is in parent directory of project
        base_path = Path.cwd() / ".praxis-os"

        if not base_path.exists():
            # Try common alternative locations
            alternatives = [
                Path.home() / ".praxis-os",
                Path(__file__).parent.parent.parent / ".praxis-os",
            ]

            for alt in alternatives:
                if alt.exists():
                    base_path = alt
                    break
            else:
                logger.error("Could not find .praxis-os directory. Tried: %s", base_path)
                sys.exit(1)

        logger.info("Using base path: %s", base_path)

        # Load configuration with graceful fallback
        config = ConfigLoader.load(base_path)
        logger.info("Configuration loaded successfully")

        # Validate configuration
        errors = ConfigValidator.validate(config)
        if errors:
            logger.error("Configuration validation failed:")
            for error in errors:
                logger.error("  %s", error)
            sys.exit(1)

        logger.info("Configuration validated successfully")

        # Create server using factory with dependency injection
        factory = ServerFactory(config)
        mcp = factory.create_server()

        # Run with stdio transport for Cursor integration
        logger.info("Starting MCP server with stdio transport")
        mcp.run(transport="stdio")

    except KeyboardInterrupt:
        logger.info("Server shutdown requested")
    except Exception as e:
        logger.error("Server failed: %s", e, exc_info=True)
        sys.exit(1)


if __name__ == "__main__":
    main()

<environment_details>
# Cursor Visible Files
(No visible files)

# Cursor Open Tabs
universal/standards/ai-assistant/rag-content-authoring.md
universal/standards/ai-assistant/MCP-TOOLS-GUIDE.md

# Current Time
10/10/2025, 9:21:54 PM (America/Los_Angeles, UTC-7:00)

# Context Window Usage
22,634 / 200K tokens used (11%)

# Current Mode
ACT MODE
</environment_details>

---

**Assistant:**

[Unexpected content type]

<read_file>
<path>mcp_server/rag_engine.py</path>
<task_progress>
- [x] Orient with prAxIs OS standards (MCP not available, proceeding with direct analysis)
- [x] Examine project structure and purpose
- [x] Analyze key components and architecture (examining MCP server)
- [ ] Review documentation and standards
- [ ] Identify MCP tools and workflows
- [ ] Summarize findings
</task_progress>
</read_file>

[Response interrupted by a tool use result. Only one tool may be used at a time and should be placed at the end of the message.]

---

**User:**

[read_file for 'mcp_server/rag_engine.py'] Result:
"""
prAxIs OS RAG Engine - LanceDB Implementation
Semantic search with metadata filtering and fallback mechanisms.

Switched from ChromaDB to LanceDB for:
- Built-in WHERE clause filtering (fast!)
- No singleton client conflicts (clean hot reload)
- Simpler reconnection logic

100% AI-authored via human orchestration.
"""

# pylint: disable=too-many-instance-attributes
# Justification: RAGEngine requires 12 attributes to manage vector DB connection,
# embedding models, caching, and configuration - all essential state

# pylint: disable=too-many-arguments,too-many-positional-arguments
# Justification: __init__ needs 6 parameters for flexible configuration of
# database path, embedding provider, model, dimension, cache, and LLM fallback

# pylint: disable=import-outside-toplevel
# Justification: Heavy ML dependencies (sentence-transformers, openai) loaded
# lazily only when needed to reduce startup time and support optional features

# pylint: disable=broad-exception-caught
# Justification: RAG engine catches broad exceptions for robustness - vector
# search failures fall back to grep, ensuring service availability

# pylint: disable=too-many-locals
# Justification: Complex search logic with filtering, ranking, and fallback
# requires multiple intermediate variables for clarity

import hashlib
import json
import logging
import subprocess
import threading
import time
from pathlib import Path
from typing import Any, Dict, List, Optional

import lancedb

from .models.rag import SearchResult

logger = logging.getLogger(__name__)


class RAGEngine:
    """
    Semantic search engine for prAxIs OS standards.

    Features:
    - Vector similarity search via LanceDB
    - Metadata filtering at DB level (phase, tags, framework)
    - Relevance ranking with critical content boosting
    - Grep fallback for offline/error scenarios
    - Query result caching (TTL: 1 hour)
    """

    def __init__(
        self,
        index_path: Path,
        standards_path: Path,
        embedding_provider: str = "local",
        embedding_model: str = "all-MiniLM-L6-v2",
        cache_ttl_seconds: int = 3600,
    ):
        """
        Initialize RAG engine.

        Args:
            index_path: Path to LanceDB index
            standards_path: Path to prAxIs OS standards for grep fallback
            embedding_provider: Provider for embeddings ("local" default or "openai")
            embedding_model: Model to use for embeddings
            cache_ttl_seconds: Cache time-to-live in seconds (default: 1 hour)
        """
        self.index_path = index_path
        self.standards_path = standards_path
        self.embedding_provider = embedding_provider
        self.embedding_model = embedding_model
        self.cache_ttl_seconds = cache_ttl_seconds

        # Query cache: {query_hash: (result, timestamp)}
        self._query_cache: Dict[str, tuple] = {}

        # Concurrency control for safe hot reload
        self._lock = threading.RLock()  # Reentrant lock for nested calls
        self._rebuilding = threading.Event()  # Signal when rebuild in progress

        # Initialize embedding model
        if self.embedding_provider == "local":
            from sentence_transformers import SentenceTransformer

            self.local_model = SentenceTransformer(embedding_model)
        else:
            self.local_model = None

        # Initialize LanceDB connection
        try:
            logger.info("Initializing RAG engine with index at %s", index_path)
            self.db = lancedb.connect(str(index_path))
            self.table = self.db.open_table("praxis_os_standards")
            chunk_count = self.table.count_rows()
            logger.info("LanceDB table loaded: %s chunks", chunk_count)
            self.vector_search_available = True
        except Exception as e:
            logger.warning("Failed to initialize LanceDB: %s", e)
            logger.warning("Vector search unavailable, grep fallback will be used")
            self.vector_search_available = False
            self.db = None
            self.table = None

    def search(
        self,
        query: str,
        n_results: int = 5,
        filters: Optional[Dict] = None,
    ) -> SearchResult:
        """
        Search prAxIs OS standards with intelligent retrieval.

        Steps:
        1. Check cache for recent identical query
        2. Generate query embedding
        3. Vector search with metadata filtering (WHERE clauses)
        4. Rank and boost critical content
        5. Return structured results

        If vector search fails, falls back to grep.

        Args:
            query: Search query text
