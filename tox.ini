[tox]
envlist = py313,lint,type
skipsdist = True

[testenv]
deps =
    pytest>=8.0
    pytest-cov>=4.0
    pytest-asyncio>=0.21
    tiktoken>=0.5.0
    -r mcp_server/requirements.txt
commands =
    pytest tests/ -v --cov=mcp_server --cov-report=term-missing --cov-report=html

[testenv:unit]
description = Run unit tests only
commands =
    pytest tests/unit/ -v --cov=mcp_server --cov-report=term-missing

[testenv:integration]
description = Run integration tests only
passenv = 
    HONEYHIVE_API_KEY
    HONEYHIVE_PROJECT
commands =
    pytest tests/integration/ -v

[testenv:lint]
description = Run linting checks
deps =
    pylint>=3.0
    black>=23.0
    isort>=5.0
skip_install = True
commands =
    black --check mcp_server/ tests/
    isort --check-only mcp_server/ tests/
    pylint mcp_server/

[testenv:type]
description = Run type checking
deps =
    mypy>=1.0
    types-PyYAML
    -r mcp_server/requirements.txt
commands =
    mypy mcp_server/ --ignore-missing-imports

[testenv:format]
description = Auto-format code
deps =
    black>=23.0
    isort>=5.0
skip_install = True
commands =
    black mcp_server/ tests/
    isort mcp_server/ tests/

[testenv:coverage]
description = Generate coverage report
deps =
    pytest>=8.0
    pytest-cov>=4.0
    -r mcp_server/requirements.txt
commands =
    pytest tests/ --cov=mcp_server --cov-report=html --cov-report=term
    python -c "print('\nCoverage report: htmlcov/index.html')"
